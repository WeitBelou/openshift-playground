---
- hosts: ansible-controller
  become: true

  vars_files:
    - ../credentials.yml

  tasks:
    - name: Add mappings to /etc/hosts
      blockinfile:
        path: /etc/hosts
        block: |
          {{ item.ip }} {{ item.name }}
        marker: "# {mark} ANSIBLE MANAGED BLOCK {{ item.name }}"
      with_items:
        - { name: openshift-master.internal, ip: "{{ hostvars['openshift-master.internal']['ansible_host'] }}" }
        - { name: openshift-node-1.internal, ip: "{{ hostvars['openshift-node-1.internal']['ansible_host'] }}" }
        - { name: openshift-node-2.internal, ip: "{{ hostvars['openshift-node-2.internal']['ansible_host'] }}" }

    - name: Generate inventory file
      template:
        src: templates/inventory.j2
        dest: /etc/ansible/hosts
