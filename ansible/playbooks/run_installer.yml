---
- hosts: ansible-controller
  become: true

  vars_files:
    - ../credentials.yml

  tasks:
    - name: Add mappings to /etc/hosts
      blockinfile:
        path: /etc/hosts
        block: |
          {{ item.ip }} {{ item.name }}
        marker: "# {mark} ANSIBLE MANAGED BLOCK {{ item.name }}"
      with_items:
        - { name: master.openshift, ip: "{{ hostvars['master.openshift']['ansible_host'] }}" }
        - { name: node-1.openshift, ip: "{{ hostvars['node-1.openshift']['ansible_host'] }}" }
        - { name: node-2.openshift, ip: "{{ hostvars['node-2.openshift']['ansible_host'] }}" }

    - name: Generate inventory file
      template:
        src: templates/inventory.j2
        dest: /etc/ansible/hosts
